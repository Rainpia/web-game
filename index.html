<!DOCTYPE html>
<html>
<head>
  <title>Space Gladiators</title>
  <script src="keyboard.js"></script>
  <script src="hitRectangle.js"></script>
  <script src="game.js"></script>
  <script src="pixi.dev.js"></script>
  <script src="index.js"></script>
  
  <style>
    *{
      padding: 0;margin: 0;
    }
  </style>
</head>
<body>
  <script type="text/javascript">
    // start hello world
    let type = "WebGL"
    if(!PIXI.utils.isWebGLSupported()){
      type = "canvas"
    }

    PIXI.utils.sayHello(type);
    // end hello world


    // define aliases
    const Application = PIXI.Application;
    const loader = PIXI.loader;
    const resources = PIXI.loader.resources;
    const Sprite = PIXI.Sprite;
    const TextureCache = PIXI.utils.TextureCache;
    const Rectangle = PIXI.Rectangle;
    const Graphics = PIXI.Graphics;
    const Text = PIXI.Text;
    const hitTestRectangle = PIXI.hitTestRectangle;

    
    //Create a Pixi Application
    let app = new Application();
    //Add the canvas that Pixi automatically created for you to the HTML document
    window.document.body.appendChild(app.view);

    // set view size, bg_color
    app.renderer.backgroundColor = 0x061639;
    app.renderer.view.style.position = "absolute";
    app.renderer.view.style.display = "block";
    app.renderer.autoResize = true;
    app.renderer.resize(window.innerWidth, window.innerHeight);



    //load an image and run the `setup` function when it's done
    loader
      .add("images/tileset.json")
      .on("progress", loadProgressHandler)
      .load(setup);

    function loadProgressHandler(loader, resource) {
      console.log("loading: " + resource.url); 
      console.log("progress: " + loader.progress + "%"); 
    }

    let logo, runrun, xiaofeng, liyang, wuqi, state;
    let rectangle, message;

    //This `setup` function will run when the image has loaded
    function setup() {

      //Create the cat sprite 1500x800
      let bg = new Sprite(TextureCache['bg.jpg']);
      bg.width = window.innerWidth;
      bg.height = window.innerHeight;
      app.stage.addChild(bg);

      //Create the cat sprite 1500x800
      logo = new Sprite(TextureCache['group.png']);
      logo.scale.set(0.2,0.2);
      logo.x = app.stage.width / 2 - 150;
      logo.y = app.stage.height / 2 - 100;
      app.stage.addChild(logo);

      runrun = new Sprite(TextureCache["runrun.png"]);
      runrun.width = 100;
      runrun.height = 100;
      runrun.x = 0;
      runrun.y = app.stage.height - 100;
      runrun.vx = 0;
      runrun.vy = 0;
      app.stage.addChild(runrun);

      xiaofeng = new Sprite(TextureCache["xiaofeng.png"]);
      xiaofeng.width = 100;
      xiaofeng.height = 100;
      xiaofeng.x = app.stage.width - 100;
      xiaofeng.y = 0;
      app.stage.addChild(xiaofeng);

      liyang = new Sprite(TextureCache["liyang.png"]);
      liyang.width = 100;
      liyang.height = 100;
      liyang.x = app.stage.width - 100;
      liyang.y = app.stage.height - 100;
      app.stage.addChild(liyang);

      wuqi = new Sprite(TextureCache["wuqi.png"]);
      wuqi.width = 100;
      wuqi.height = 100;
      wuqi.x = 0;
      wuqi.y = 0;
      app.stage.addChild(wuqi);

      rectangle = new Graphics();
      rectangle.lineStyle(4, 0xFF3300, 1);
      rectangle.beginFill(0x66CCFF);
      rectangle.drawRect(0, 0, 64, 64);
      rectangle.endFill();
      rectangle.x = 170;
      rectangle.y = 170;
      app.stage.addChild(rectangle);

      let circle = new Graphics();
      circle.beginFill(0x9966FF);
      circle.drawCircle(0, 0, 32);
      circle.endFill();
      circle.x = 64;
      circle.y = 130;
      app.stage.addChild(circle);

      let ellipse = new Graphics();
      ellipse.beginFill(0xFFFF00);
      ellipse.drawEllipse(0, 0, 50, 20);
      ellipse.endFill();
      ellipse.x = 180;
      ellipse.y = 130;
      app.stage.addChild(ellipse);

      let roundBox = new Graphics();
      roundBox.lineStyle(4, 0x99CCFF, 1);
      roundBox.beginFill(0xFF9933);
      roundBox.drawRoundedRect(0, 0, 84, 36, 10)
      roundBox.endFill();
      roundBox.x = 48;
      roundBox.y = 190;
      app.stage.addChild(roundBox);

      let line = new Graphics();
      line.lineStyle(4, 0xFFFFFF, 1);
      line.moveTo(0, 0);
      line.lineTo(80, 50);
      line.x = 32;
      line.y = 32;
      app.stage.addChild(line);

      let triangle = new Graphics();
      triangle.beginFill(0x66FF33);

      //Use `drawPolygon` to define the triangle as
      //a path array of x/y positions

      triangle.drawPolygon([
          -32, 64,             //First point
          32, 64,              //Second point
          0, 0                 //Third point
      ]);

      //Fill shape's color
      triangle.endFill();

      //Position the triangle after you've drawn it.
      //The triangle's x/y position is anchored to its first point in the path
      triangle.x = 180;
      triangle.y = 22;

      app.stage.addChild(triangle);

      message = new Text("Hello Pixi!");
      message.style = {fill: "white", font: "16px PetMe64"};
      app.stage.addChild(message);


      //Capture the keyboard arrow keys
      let left = keyboard("ArrowLeft"),
          up = keyboard("ArrowUp"),
          right = keyboard("ArrowRight"),
          down = keyboard("ArrowDown");

      //Left arrow key `press` method
      left.press = () => {
        //Change the cat's velocity when the key is pressed
        runrun.vx = -5;
        runrun.vy = 0;
      };
      
      //Left arrow key `release` method
      left.release = () => {
        //If the left arrow has been released, and the right arrow isn't down,
        //and the runrun isn't moving vertically:
        //Stop the runrun
        if (!right.isDown && runrun.vy === 0) {
          runrun.vx = 0;
        }
      };

      //Up
      up.press = () => {
        runrun.vy = -5;
        runrun.vx = 0;
      };
      up.release = () => {
        if (!down.isDown && runrun.vx === 0) {
          runrun.vy = 0;
        }
      };

      //Right
      right.press = () => {
        runrun.vx = 5;
        runrun.vy = 0;
      };
      right.release = () => {
        if (!left.isDown && runrun.vy === 0) {
          runrun.vx = 0;
        }
      };

      //Down
      down.press = () => {
        runrun.vy = 5;
        runrun.vx = 0;
      };
      down.release = () => {
        if (!up.isDown && runrun.vx === 0) {
          runrun.vy = 0;
        }
      };

      state = around;

      app.ticker.add(delta => gameLoop(delta ));
    }

    const gameLoop = (delta)  =>{
      state(delta, runrun);
      // state(delta, xiaofeng);
      // state(delta, liyang);
      // state(delta, wuqi);
    }
    function around(delta, who){

      who.x += who.vx;
      who.y += who.vy;

      //check for a collision between the cat and the box
    if (hitRectangle(who, rectangle)) {

      //if there's a collision, change the message text
      //and tint the box red
      message.text = "hit!";
      rectangle.tint = 0xff3300;

    } else {

      //if there's no collision, reset the message
      //text and the box's color
      message.text = "No collision...";
      rectangle.tint = 0xccff99;
    }

      // who.vx = 5;
      // who.vy = 10;
      
      // if(who.y >= (app.stage.height - 100) && who.x < (app.stage.width - 100) ){
      //   who.x += who.vx;
      // }

      // if(who.x >= (app.stage.width - 100) && who.y > 0){
      //   who.y -= who.vy;
      // }

      // if(who.y <= 0 && who.x > 0){
      //   who.x -= who.vx;
      // }

      // if(who.x <= 0 && who.y < (app.stage.height - 100)){
      //   who.y += who.vy;
      // }
    }

  </script>
</body>
</html>